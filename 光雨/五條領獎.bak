[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=e2d1f1e1-ea6a-4596-842d-87edee291b57
Description=五條領獎_自動備份
Enable=0
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=1
QUI=Form1
[Relative]
SetupOCXFile=
[Comment]

[UIPackage]
UEsDBBQAAgAIAG49MFY6AZGSeAMAAAgmAAAJABEAVUlQYWNrYWdlVVQNAAc7AMVjOwDFYzsAxWPtWEtPU0EU/m7Lo+VRWoHKSywgiis1cWHQmFgi0QSR0OrCRJMKVYilkLYa/Dms2eiGrT9Bt+70H7DCldRvbufSKYFwZ+6VS5MecjoBeu43c86cx3fDqMmP74lfO19HfuOYPEQYh9UoOpS/WVJtiQMh+fthtVp1/lxtSVPJX2qbjGEn13aqiHmE2kWNUrupvdQeaqwWevRRE9LusOXGppVlbPKnghQeo8i1hM/QkSRvjPMs64zvfrn3Z/b+zZ9WGPJiUV7gKW7DXCKwLAc/dAaus6r/m0MWCx520CXxkzJ3dPGz9PcW8lhEDhtcdeUSQjZ+QtZet3ZtcnXy96JoS85X5jdLGx7SD8L+jgd7C97Eq33Qsr+/78tzXrP4HRjYmdadev0LNcx8bmPm1ErRdXJ4i4LhHmKsf91yVnGLH1Lq30uso0w13UHc4PxhBX+ZqDms4jn9UNDsvU7975HPdIvfpuBnib/Nvu8h/pbu+VW+MMfpo0AtGe5kwAC/XTl/HT/NOKzggz4+xNzcp+H/jmPxX/HofzGbRzTwO1Gb4YW84s0r8f7l+Wmaf4PyTG7xI8r5F+h7fa83nj8un+cWP3pi/DPcxxr9oFcNhxj/fjsP3eN3KfiPOP1t2TWgRC1yD3pVKMnzR1HjZW7xuxX8oKUzYPyDk31mjxXPMqlMrlhOZfKl9Xf/CX96902g9vO8+0Vv9Ue7/4l+9eDo/hfYfd9zDyLviib1Xxu/tyH/c8y/Cvcg/JC289DpBPXacLrMGPSfmIKftp9fq79u8E6oP9YA6u/d3Nj0Qe3/6zy9mH1M0O36o+3/uIK/RPxtohc4hZlIzAA/0RB/wf/NGQz5/xH+8CnfOQ/+r3N+0as6cDEk/bFS2Sx6tTePX7Pzz92DvbIX/h0E/xPzktP3/eB/V7mOw/38M4Bg+d8g/OV/Ka6XNc6fRLD8T+zV4f9B8L8h+Mv/RrlOafh/GP7yvwmuYxr4I6jzP6/i9f1Vv9zPHnXWwD7o+tvs/MUP/j8tY+j2/o3CX/5/Tea0W/wx+Mv/b3C9roF/Bf7yf/G8SQ38cQU/CP4n+rXD/4KY/1PK+Rft2G/Q9wVj/iVwZzT8P6HgPyHeJ2P2V4u/7vkn4d/7n1t7a57s737zZj+6k0VLzGWJ9y3P3Cvzc9XgDo4Y5N8U/H3/qIvvtzQz/j9QSwECFwsUAAIACABuPTBWOgGRkngDAAAIJgAACQAJAAAAAAAAAAAAAIAAAAAAVUlQYWNrYWdlVVQFAAc7AMVjUEsFBgAAAAABAAEAQAAAALADAAAAAA==


[Script]
Sub 綁定窗口()
	
	Hwnd = Plugin.Window.Find(0, "Ragnarok")
	If Hwnd > 0 Then 
    	Call 大漠()
    	Delay 100
		TracePrint "[" & 句柄 & "] 領獎腳本開始!"
    		Do
				' 當在地圖origin03
    			If "origin03" = dm.ReadString(hwnd, "011513C0", 0, 15) Then 
    				' 抓取提示過關
    				dm_ret = dm.FindStr(6,706,298,737, "好啦恭喜你們也成為強咒術師", "ffff00-000000", 1.0, intX, intY)
    				If intX > 0 Then 
    					' 血量少於2直接復活
    					If int(Plugin.Memory.Read32Bit(Hwnd, &H01155E14)) <= 2 Then 
    						Delay int(10* rnd)*100
    						復活 (2)
    					Else 
    						' 找尋NPC
    						dm_ret = dm.FindColor(204, 165, 500, 529, "402834-020202", 1.0, 0, intX, intY)
    						If intX > 0 Then 
    							dm.moveto intX, intY
    							dm.LeftDown 
    							dm.LeftUp
    							Delay 100
    						End If
    						Do
    							dm.KeyDown 13
    							dm.KeyUp 13
    							Delay 50
    						Loop While int(Plugin.Memory.Read32Bit(Hwnd, &H00F05990)) > 0
    					End If
    				End If
    			End If
				Delay 1000
    		Loop
		End If
End Sub

Function 復活(Run)
	If Run >0 Then
		Die = array("","移動到儲存場所","在原地復活")
		Do
			dm.KeyPress 27
			Delay 250
			dm_ret = dm.FindStr(345, 435, 674, 565, Die(Run), "000000-313131", 1.0, intX, intY)
		Loop Until intX > 0 And intY > 0
		TracePrint "找到關鍵字: [移動到儲存場所]"
		If Run = 1 Then
			Do
				dm.MoveTo intX, intY
    			dm.LeftClick
				dm_ret = dm.FindStr(352,289,661,435, "確認", "000000-313131", 1.0, intX2, intY2)
			Loop Until intX2 > 0 And intY2 > 0
			TracePrint "找到關鍵字: [確認]"
		ElseIf Run = 2 Then
			intX2 = intX
			intY2 = intY
		End If
		Do
			dm.MoveTo intX2, intY2
    		dm.LeftClick 
    		Delay 200
			血 = int(Plugin.Memory.Read32Bit(句柄, &H011D0A14))
		Loop Until 血 > 1
		TracePrint "確認: [復活]"
	End If
End Function


Function 大漠()
	set dm = createobject("dm.dmsoft")
	base_path = dm.GetBasePath() & "光雨"
	dm_ret = dm.SetPath(base_path)//全局路徑
	dm_ret = dm.SetDict(0,"關鍵字.txt")//設定字庫
	dm_ret = dm.BindWindow(Hwnd, "gdi", "dx2", "windows", 4)//綁定窗口
	MsgBox "綁定窗口:"&Hwnd&" 是否成功:"&dm_ret
End Function

Sub OnThreadExit()
	dm.UnBindWindow 
	TracePrint "[腳本停止]大漠解除綁定窗口: " & 句柄
End Sub

Event Form1.Button1.Click
	BeginThread 綁定窗口
End Event