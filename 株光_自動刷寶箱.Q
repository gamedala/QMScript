[General]
SyntaxVersion=2
BeginHotkey=121
BeginHotkeyMod=0
PauseHotkey=0
PauseHotkeyMod=0
StopHotkey=123
StopHotkeyMod=0
RunOnce=1
EnableWindow=
MacroID=48224ce0-b6a3-4e34-b9c1-e1f7677086d3
Description=株光_自動刷寶箱
Enable=1
AutoRun=0
[Repeat]
Type=0
Number=1
[SetupUI]
Type=2
QUI=
[Relative]
SetupOCXFile=
[Comment]

[Attachment]
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


[Script]
Global Start,驗證卷軸,技能,Hwnd1
Hwnd1 = Plugin.Window.MousePoint()
Dim int_Map,NpcX,NpcY,NpcX2,NpcY2,對話延遲,等待延遲,尋找隨機延遲,屬光券
Start = 0
NpcX = 553
NpcY = 382
NpcX2 = 532
NpcY2 = 270
對話延遲 = 300
//------ 設定以下
等待延遲 = 3000
//等待隊友到 0=不等待
尋找隨機延遲 = 5
驗證卷軸 = 115
屬光券 = 112
技能 = 113
//------ 設定以上

Call 大漠設定()
PID=BeginThread(驗證技能)
Do
	now_map = Plugin.Memory.Read32Bit(Hwnd1, &H0015F258)
	now_map_X = Plugin.Memory.Read32Bit(Hwnd1, &H010F07A8)
	now_map_Y = Plugin.Memory.Read32Bit(Hwnd1, &H010F07AC)
	Npc_Msg = Plugin.Memory.Read32Bit(Hwnd1, &H00EB78B0)
	最大血 = int(Plugin.Memory.Read32Bit(Hwnd1, &H01107BF0))
	血 = int(Plugin.Memory.Read32Bit(Hwnd1, &H01107BEC))
	血量 = fix((血 / 最大血) * 100)

	If Npc_Msg > 0 Then 
		TracePrint "卡窗enter"
		call 按鍵(13,1,對話延遲)
	End If
	
	If 血量 = 0 Then 
		Call Plugin.Msg.Tips(HP & "您已死亡!")
		Delay 1000
	ElseIf now_map = 16 And now_map_X = 216 And now_map_Y = 209 Then
		TracePrint "創建或銷毀副本"
		dm_ret = dm.FindStr(225,43,920,345,"一般副本","ffffff-000000",0.9,intX,intY)
		If intX > 0 And intY > 0 Then 
			dm.MoveTo intX + 30, intY + 50
			Delay 對話延遲
			dm_ret = dm.FindStr(225,43,920,345,"副本傳送員|副本|送員","94bdf7-000000",1.0,intX,intY)
			If intX > 0 And intY > 0 Then 
				Start = 0
				Val_inst = Plugin.Memory.Read32Bit(Hwnd1, &H01107FD0)
				call 副本資訊(Val_inst)
			End If
		End If
	ElseIf now_map = 16 And now_map_X = 217 And now_map_Y = 276 Then
		TracePrint "屬光券回副本"
		call 按鍵(屬光券&",13,13,13",0,對話延遲)
	ElseIf now_map = 27 And now_map_X = 35 And now_map_Y = 57 Then
		TracePrint "副本開始"
		If Start = 0 Then 
			Delay 等待延遲
			dm.MoveTo NpcX, NpcY
			Delay 對話延遲
			dm_ret = dm.FindStr(473,292,628,526,"巨鱷寶箱","94bdf7-000000",1.0,intX,intY)
			If intX > 0 And intY > 0 Then 
				dm.MoveTo NpcX, NpcY
				dm.RightClick
				Delay 對話延遲
				Call 按鍵(13,1,對話延遲)
				Start = Start + 1
				TracePrint "階段: " & Start
			End If
		End If
	ElseIf now_map = 27 And now_map_X = 98 And now_map_Y = 80 Then
		//TracePrint "尋找: [寶箱沼鱷]"
		If Start = 1 Then
			Start = Start + 1
			TracePrint "階段: " & Start
		ElseIf Start >= 2 And Start < 7 Then
			dm.MoveTo NpcX2, NpcY2
			Delay 對話延遲
			dm_ret = dm.FindStr(349,140,701,490,"寶箱沼鱷","94bdf7-000000",1.0,intX,intY)
			If intX > 0 And intY > 0 Then 
				If Start <> 7 Then
					尋找延遲 = fix(((尋找隨機延遲 * rnd)+0.5)*1000)
					TracePrint "尋找寶箱沼鱷延遲:"& 尋找延遲
				Delay 尋找延遲
				End If
				dm.MoveTo NpcX2, NpcY2
				dm.RightClick
				Start = Start + 1
				TracePrint "階段: " & Start
			End If
		Else 
			//Do
				dm.MoveTo NpcX2, NpcY2
				Delay 對話延遲
				dm_ret = dm.FindStr(349,140,701,490,"寶箱","94bdf7-000000",1.0,intX,intY)
				If intX > 0 And intY > 0 Then 
					dm.MoveTo NpcX2, NpcY2
					dm.RightClick
					Start = Start + 1
					TracePrint "階段: " & Start
				End If
			//Loop Until intX > 0 And intY > 0
		End If
	ElseIf now_map <> 27 And now_map <> 16 Then
		TracePrint 地圖 & "進錯副本離開" & now_map
		Start = 0
		call 按鍵(屬光券&",13,13,13",0,對話延遲)
	End If
	Delay 1000
Loop

Sub 驗證技能()
Delay 500
Call 大漠設定()
Do
	If Start = 1 Or Start = 7 Then
		dm_ret = dm.FindPic(10, 520, 255, 740, "C:\dm\ban.bmp", "000000", 0.8, 0, intX, intY)
		If intX > 0 And intY > 0 Then 
			Call 驗證()
		Else
			dm.KeyPress 技能
		End If
	Else
		Delay 1000
	End If
Loop
End Sub

Function 驗證()
	call 按鍵(驗證卷軸, 11, 20)
	dm_ret = dm.FindPic(0, 0, 1024, 768, "C:\dm\msg.bmp", "000000", 0.9, 0, intX, intY)
	If intX > 0 And intY > 0 Then 
		dm_ret = dm.FindStr(intX, intY, intX+280, intY+180, "=?", "000000-000000", 1.0, intX, intY)
		If intX > 0 And intY > 0 Then 
			Delay 500
			verify = dm.Ocr(intX - 110, intY -7, intX , intY + 7,"000000-000000",1.0)
			n = Len(verify)
			i = 1
			verify2 = "" 
			For n
				y = Mid(verify, i, 1)
				m = Asc(y)
				If m >0 And m<>32 Then
					verify2 = verify2 & y
				End If
				i = i+1
			Next
			verify = Eval(verify2)
			Call Plugin.Bkgnd.SendString(Hwnd1, verify)
			Call Plugin.Msg.Tips("驗證提示: " & verify)
			dm.KeyPress 13
		End If
	End If
End Function

Function 副本資訊(Val_inst)
	dm.RightClick 
	Delay 對話延遲
	If Val_inst = 2780228778 Then
		選項 = 0
	ElseIf Val_inst = 4004661672 Then
		選項 = 0
	ElseIf Val_inst = 1471307954 Then
		選項 = 0
	ElseIf Val_inst = 1218739907 Then
		選項 = 0
	ElseIf Val_inst = 3349806254 Then
		選項 = 0
	ElseIf Val_inst = 3953438386 Then
		選項 = 0
	ElseIf Val_inst = 1103063210 Then
		選項 = 0
	ElseIf Val_inst = 1958760879 Then
		選項 = 0
	ElseIf Val_inst = 1269331392 Then
		選項 = 0
	ElseIf Val_inst = 1789245371 Then
		選項 = 0
	ElseIf Val_inst = 1288100537 Then
		選項 = 0
	Else
		選項 = 1
	End If
	If 選項 = 1 Then
		Call 按鍵("40,40,40,40,40,40,40,13,13,40,13",0,對話延遲)
	ElseIf 選項 = 0 Then
		Call 按鍵("13,40,40,13,13",0,對話延遲)
	End If
End Function

Function 按鍵(按鍵組,次數,延遲)
	Dim arr
	arr = Split(按鍵組, ",")
	If 次數 > 0 Then
		For i = 1 To 次數
			TracePrint "按:" & 按鍵組 & "次數:" & i & "延遲:" & 延遲
			dm.KeyPress 按鍵組
			Delay 延遲
		Next
	ElseIf UBOUND(arr) > 0 Then
		For i = 0 To UBOUND(arr)
			TracePrint "按:" & arr(i) & "次數:" & i+1 & "延遲:" & 延遲
			dm.KeyPress arr(i)
			if arr(i) = 40 Then
				Delay 30
			Else
				Delay 延遲
			End If
		Next
	End If
End Function

Function 大漠設定()
	set dm = createobject("dm.dmsoft")
	base_path = dm.GetBasePath()
	dm_ret = dm.SetPath(base_path)
	dm_ret = dm.SetDict(0,"pass.txt")
	dm_ret = dm.BindWindow(Hwnd1,"gdi","dx2","windows",4)
End Function